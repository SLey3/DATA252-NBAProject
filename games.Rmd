---
title: "ML_project"
author:
  - Jerrick Little
  - Sergio Ley Languren
  - Aadem Isai
  - D'Ante Dea
date: "2026-02-11"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(GGally)
library(caret)

setwd("C:/Users/jerri/OneDrive/Documents/ML_project/DATA252-NBAProject") # or wherever your project path is located at

DATA_DIR = "./data"
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
games = read.csv(paste(DATA_DIR, "/Games.csv", sep = ""))
teams = read.csv(paste(DATA_DIR, "/TeamStatistics.csv", sep = ""))
games = games %>%
  filter(gameDateTimeEst >= "2019-07-29 22:00:00") %>%
  filter(gameType == "Regular Season") %>%
  mutate(
    #Positive means home team won
    point_diff = homeScore - awayScore,
    total_points = homeScore + awayScore,
    winner = factor(winner),
    gameType = factor(gameType),
    gameSubtype = factor(gameSubtype)
  )
games <- games %>%
  mutate(winner_name = case_when(
    winner == hometeamId ~ hometeamName,
    winner == awayteamId ~ awayteamName,
    TRUE ~ NA_character_
  ))
# Getting all the regular szn games in teams data
teams = teams %>%
  filter(gameDateTimeEst >= "2019-07-29 22:00:00")%>%
  semi_join(games %>% filter(gameType == "Regular Season"), by = "gameId")%>%
  mutate(point_diff = teamScore - opponentScore)

names(games)
names(teams)

nba_divs <- data.frame(
  teamId = c(
    1610612738, 1610612751, 1610612752, 1610612755, 1610612761,

    1610612741, 1610612739, 1610612765, 1610612754, 1610612749,

    1610612737, 1610612766, 1610612748, 1610612753, 1610612764,

    1610612743, 1610612750, 1610612760, 1610612757, 1610612762,

    1610612744, 1610612746, 1610612747, 1610612756, 1610612758,

    1610612742, 1610612745, 1610612763, 1610612740, 1610612759
  ),
  teamName = c(
  "Celtics", "Nets", "Knicks", "76ers", "Raptors",

    "Bulls", "Cavaliers", "Pistons", "Pacers", "Bucks",

    "Hawks", "Hornets", "Heat", "Magic", "Wizards",
   "Nuggets", "Timberwolves", "Thunder", "Trail Blazers", "Jazz",

    "Warriors", "Clippers", "Lakers", "Suns", "Kings",

    "Mavericks", "Rockets", "Grizzlies", "Pelicans", "Spurs"
  ),
  conference = c(
    rep("Eastern", 5),

    rep("Eastern", 5),

    rep("Eastern", 5),

    rep("Western", 5),

    rep("Western", 5),

    rep("Western", 5)
  ),
  division = c(
    rep("Atlantic", 5),

    rep("Central", 5),

    rep("Southeast", 5),

    rep("Northwest", 5),

    rep("Pacific", 5),

    rep("Southwest", 5)
  ),
  stringsAsFactors = FALSE
)

teams <- teams %>%
  left_join(nba_divs %>% select(teamId, conference, division), 
            by = "teamId")
teams <- teams %>%
  left_join(games %>% select(gameId, attendance, winner_name, arenaCity),
            by = "gameId")
names(teams)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot_data <- teams %>%
  select(
    teamScore,        # Numeric response variable
    attendance,       # Numeric predictor
    win,     # Numeric predictor           # Categorical
    arenaCity,
    assists# Categorical
  ) %>%
  # Remove rows with missing values
  drop_na()

plot_data2 <- teams %>%
  select(
    teamScore,        # Numeric response variable
    reboundsTotal,       # Numeric predictor
    win,     # Numeric predictor           # Categorical
    arenaCity,
    fieldGoalsPercentage# Categorical
  ) %>%
  # Remove rows with missing values
  drop_na()
plot_data3 <- teams %>%
  select(
    teamScore,        # Numeric response variable
    turnovers,       # Numeric predictor
    win,     # Numeric predictor           # Categorical
    conference,
    foulsPersonal# Categorical
  ) %>%
  # Remove rows with missing values
  drop_na()
plot_data4 <- teams %>%
  select(
    teamScore,        # Numeric response variable
    freeThrowsMade,       # Numeric predictor
    win,     # Numeric predictor           # Categorical
    steals,
    pointsInThePaint# Categorical
  ) %>%
  # Remove rows with missing values
  drop_na()

ggpairs(plot_data, cardinality_threshold = 34,
        title = "NBA Games Analysis: Pairs Plot",
        aes( alpha = 0.5)) +
  theme(axis.text.x = element_text(angle = 90))+
  theme_bw()

ggpairs(plot_data2, cardinality_threshold = 35,
        title = "NBA Games Analysis: Pairs Plot",
        aes( alpha = 0.5)) +
  theme(axis.text.x = element_text(angle = 90))+
  theme_bw()
ggpairs(plot_data3, cardinality_threshold = 34,
        title = "NBA Games Analysis: Pairs Plot",
        aes( alpha = 0.5)) +
  theme(axis.text.x = element_text(angle = 90))+
  theme_bw()
ggpairs(plot_data4, cardinality_threshold = 34,
        title = "NBA Games Analysis: Pairs Plot",
        aes( alpha = 0.5)) +
  theme(axis.text.x = element_text(angle = 90))+
  theme_bw()
ggpairs(plot_data5, cardinality_threshold = 34,
         title = "NBA Games Analysis: Pairs Plot",
         aes( alpha = 0.5)) +
   theme(axis.text.x = element_text(angle = 90))+
   theme_bw()
ggpairs(plot_data6, cardinality_threshold = 34,
         title = "NBA Games Analysis: Pairs Plot",
         aes( alpha = 0.5)) +
   theme(axis.text.x = element_text(angle = 90))+
   theme_bw()
ggpairs(plot_data7, cardinality_threshold = 34,
         title = "NBA Games Analysis: Pairs Plot",
         aes( alpha = 0.5)) +
   theme(axis.text.x = element_text(angle = 90))+
   theme_bw()
ggpairs(plot_data8, cardinality_threshold = 34,
         title = "NBA Games Analysis: Pairs Plot",
         aes( alpha = 0.5)) +
   theme(axis.text.x = element_text(angle = 90))+
   theme_bw()

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

# Part 2 Q3
- For every one rebound, the point diff will go up .8. By the end of the game, a team will have around 45 rebounds. So the point diff will be around 0.
```{r}
lm_mod = lm(point_diff ~ reboundsTotal, data = teams, na.action = na.exclude)
summary(lm_mod)
ggplot(teams, aes(x = reboundsTotal, y = point_diff)) +
  geom_point(alpha = 0.2) +
  geom_line(aes(y = predict(lm_mod)), color = "blue4", linewidth = 1)

```
# Part 2 Q4
- The slope is .82 for both since they're parralel. The Eastern conference is the reference conference so that intercept is -36.12 and the western conference intercept is -36.12 + .283. They're not far off from eachother and basically overlay.
```{r}
teams$conference = factor(teams$conference)
parallel_mod = lm(point_diff ~ reboundsTotal + conference, data = teams,na.action = na.exclude)
summary(parallel_mod)

ggplot(teams, aes(x = reboundsTotal, y = point_diff, color = conference)) +
  geom_point(alpha = 0.2) +
  geom_line(aes(y = predict(parallel_mod)), alpha = 8, linewidth = 2)
```

# Part 2 Q 6
- For the eastern conference, it's -36.13 + .816 * reboundsTotal. The Western conference is (-36.13 + .302) + (.816 - .00043) * reboundsTotal. Again VERY similar lines.
```{r}
interaction_mod <- lm(point_diff ~ reboundsTotal * conference, data = teams, na.action = na.exclude)
summary(interaction_mod)

ggplot(teams, aes(x = reboundsTotal, y = point_diff, color = conference)) +
  geom_point(alpha = 0.2) +
  geom_line(aes(y = predict(interaction_mod)), alpha = 1, linewidth = 2)

```
# Part 2 Q 7
- The parallel lines RMSE test has the smallest RMSE with a value of 14.1708. However, all three and honestly, all 6 are SUPER similar. This corresponds with what we saw in our graphs. This is because conference and rebounds don't contribute much to the point differential. All cross validated models are bigger but that makes sense because it wasn't trained on the data like the whole RMSE has been. The whole RMSE tests have already seen every data point.
```{r}
teams_clean <- teams[, c("point_diff", "reboundsTotal", "conference")]
teams_clean <- na.omit(teams_clean)
ctrl <- trainControl(method = "cv", number = 10)

simple_cv <- train(point_diff ~ reboundsTotal, 
                   data = teams_clean, method = "lm", trControl = ctrl)

parallel_cv <- train(point_diff ~ reboundsTotal + conference, 
                     data = teams_clean, method = "lm", trControl = ctrl)

interaction_cv <- train(point_diff ~ reboundsTotal * conference, 
                        data = teams_clean, method = "lm", trControl = ctrl)

simple_mod      <- lm(point_diff ~ reboundsTotal, data = teams_clean)
parallel_mod    <- lm(point_diff ~ reboundsTotal + conference, data = teams_clean)
interaction_mod <- lm(point_diff ~ reboundsTotal * conference, data = teams_clean)

rmse <- function(model) sqrt(mean(residuals(model)^2))

results <- data.frame(
  Model      = c("Simple", "Parallel Lines", "Interaction"),
  RMSE_whole = c(rmse(simple_mod), rmse(parallel_mod), rmse(interaction_mod)),
  RMSE_cv    = c(simple_cv$results$RMSE, parallel_cv$results$RMSE, interaction_cv$results$RMSE)
)
print(results)
```

# Extra tests vvv
```{r}
lm(seasonWins ~ point_diff, data = teams, se = FALSE)
lm(formula = teamScore ~ fieldGoalsPercentage + threePointersPercentage + 
    freeThrowsPercentage, data = teams)
lm(teamScore ~ home, data = teams) # Playing at home gives about 2 point increase in team score
lm(win ~ home + attendance, data = teams) # playing at home teams have on average 54.65% chance of winning, away 45.34... attendance basically zero so not much impact on winning.
lm(point_diff ~ assists + turnovers + reboundsTotal, data = teams)
lm(win ~ assists + turnovers + reboundsTotal + fieldGoalsPercentage, data = teams) #- Comprehensive winning model
lm(opponentScore ~ steals + blocks + reboundsDefensive, data = teams)
lm(win ~ steals + blocks + reboundsDefensive, data = teams)
lm(win ~ opponentScore + teamScore, data = teams)

#test
```